<html>
<head>
<title>rpg</title>
<meta http-equiv="content-type" content="text/html;charset=utf-8" />
</head>
<body>

<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="js/gamepad.js"></script>
<script type="text/javascript" src="js/Update.js"></script>
<script type="text/javascript" src="js/MapCamera.js"></script>
<script type="text/javascript" src="js/MapView.js"></script>
<script type="text/javascript" src="js/CanvasMapView.js"></script>
<script type="text/javascript" src="js/MapModel.js"></script>
<script type="text/javascript" src="js/KeyWatcher.js"></script>
<script type="text/javascript" src="js/DialogView.js"></script>
<script type="text/javascript" src="js/World.js"></script>
<script type="text/javascript" src="js/game/SimpleInput.js"></script>
<script type="text/javascript">

function GameState() {
	var self = this;
}

var input = new SimpleInput();
var world = new World();
var map = new CanvasMapView(10, 10, 0, 640,480, world.getModel());
var dialog = new DialogView(10,10,1,640,480,"res/midJQ.png");

document.body.appendChild(dialog.getDiv());
document.body.appendChild(map.getDiv());

var hero = world.addCharacter(0,0,0);

for (var i=0; i<11; i++)
{
	var hh = world.addCharacter(2,i,5);
}

for (var i=0; i<11; i++)
{
	var hh = world.addCharacter(2,5,i);
}

var someone = world.addCharacter(1,2,2);

world.setOnCollide(function(predator, victim)
{
	
});

Number.prototype.clamp = function(min, max) {
  return Math.min(Math.max(this, min), max);
};

var camera = new MapHeroCamera(map, world.getModel(), hero);
map.setCamera(camera);

//dialog.setText("Haruhi", "Nagato")
dialog.hide();

var currow = 0;
var curcol = 0;
//dialog.setHighlightBox(dialog.areaGetRow(currow, currow));
var dialogActions =
{
	zActionOnce: function()
	{
		input.setActions(walkAroundActions);
		dialog.hideNextArrow();
		dialog.hide();
	}/*,
	upActionMatic: function()
	{
		currow--;
		currow = currow.clamp(0,1)
		dialog.setHighlightBox(dialog.areaGetRow(currow, currow));
	},
	downActionMatic: function()
	{
		currow++;
		currow = currow.clamp(0,1)
		dialog.setHighlightBox(dialog.areaGetRow(currow, currow));
	},
	leftActionMatic: function()
	{
		curcol--;
		curcol = curcol.clamp(0,17)
		dialog.setHighlightBox(dialog.areaGetRow(currow, currow));
	},
	rightActionMatic: function()
	{
		curcol++;
		curcol = curcol.clamp(0,17)
		dialog.setHighlightBox(dialog.areaGetRow(currow, currow));
	}*/
}

var walkAroundActions =
{
	leftArrowAction: function() { world.moveCharacter(hero, 1) },
	rightArrowAction: function() { world.moveCharacter(hero, 2) },
	upArrowAction: function() { world.moveCharacter(hero, 3) },
	downArrowAction: function() { world.moveCharacter(hero, 0) },
	zActionOnce: function()
	{
		var char = world.getCharacterInFrontOf(hero);
		if (char) {
			input.setActions({});
			dialog.show();
			dialog.startWritingText(["【Character " + char + "】", "Hello", "この中に宇宙人、未来人、異世界人、超能力者", "がいたら、あたしのところに来なさい。以上。"], function()
			{
				dialog.showNextArrow();
				input.setActions(dialogActions);
			});
			//console.log("meow");
		}
	}
};

input.setActions(walkAroundActions);

BeginUpdating(function()
{
	input.checkInputs();
	dialog.update();
	map.update();
	
}, null)

var movementDirection = 0;
world.setCharacterSlowness(23, 64);
setInterval(function()
{
    var pos = world.getCharacterPosition(23);
    
    if (pos.y === 4) {
	movementDirection = 3;
    }
    else if (pos.y === 0) {
	movementDirection = 0;
    }
    world.moveCharacter(23, movementDirection);
    
}, 100)

</script>



</body>
</html>